<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OraNutrition - Internal Process & Client Insight Board (PRD v7)</title>

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ora: {
                            primary: '#2A9D8F',  // Teal
                            dark: '#264653',     // Dark Blue
                            light: '#E9F5F5',    // Light BG
                            warning: '#E9C46A',  // Yellow
                            danger: '#E76F51',   // Red/Orange
                            accent: '#F4A261'    // Sandy
                        }
                    },
                    fontSize: {
                        'xxs': '0.65rem'
                    }
                }
            }
        }

        // PRD 5.1 Configuration Simulation
        const CONFIG = {
            slas: { stage1: 3, stage2: 14, stage3: 5 },
            blockers: { money_grace: 7, mat_buffer: 21, silent: 14 },
            zombie: { contract: 45, inventory: 7 },
            cooling: { vol_ratio: 0.6 }
        };
    </script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        /* Card & Layout */
        .card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        /* Highlight Animation for Filter Interaction */
        .card.target-highlight {
            border-color: #2A9D8F;
            box-shadow: 0 0 0 4px rgba(42, 157, 143, 0.15);
            transform: scale(1.005);
            z-index: 10;
        }

        .card-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }

        .card-footer {
            padding: 0.5rem 1rem;
            border-top: 1px solid #f3f4f6;
            background-color: #f9fafb;
            color: #9ca3af;
            font-size: 0.65rem;
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
        }

        .card-title {
            font-weight: 700;
            color: #1f2937;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* KPI Card */
        .kpi-card {
            transition: all 0.2s ease-in-out;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .kpi-card.active-filter {
            border-color: #2A9D8F !important;
            background-color: #F0FDFA;
            box-shadow: inset 0 0 0 1px #2A9D8F;
        }

        .kpi-card.active-filter::after {
            content: '\f0b0';
            /* Filter Icon */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            color: #2A9D8F;
            opacity: 0.2;
            font-size: 2rem;
            pointer-events: none;
        }

        /* Visual Bars (Zombies/Inventory) */
        .progress-bar-bg {
            background-color: #f3f4f6;
            border-radius: 9999px;
            height: 0.5rem;
            width: 100%;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            border-radius: 9999px;
            transition: width 0.5s ease;
        }

        /* Mini Gantt in Table */
        .stage-pill {
            width: 20%;
            height: 6px;
            margin-right: 2px;
            border-radius: 2px;
            display: inline-block;
            background-color: #e5e7eb;
        }

        .stage-pill.done {
            background-color: #2A9D8F;
        }

        .stage-pill.delay {
            background-color: #E76F51;
        }

        /* Scrollbar */
        .scroller::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .scroller::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 3px;
        }

        /* Tabs */
        .tab-btn {
            transition: all 0.2s;
        }

        .tab-active {
            color: #2A9D8F;
            font-weight: 700;
            text-decoration: underline;
            text-underline-offset: 4px;
        }

        .tab-inactive {
            color: #6b7280;
            font-weight: 500;
        }

        .tab-inactive:hover {
            color: #1f2937;
        }

        /* Traffic Light Dots */
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
    </style>
</head>

<body class="bg-gray-50 flex h-screen overflow-hidden text-gray-800">

    <!-- Sidebar -->
    <aside class="w-20 flex-shrink-0 flex flex-col z-20 shadow-sm transition-all bg-[#297A88]">
        <div class="h-16 flex items-center justify-center bg-white border-b border-gray-100">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAmCAYAAABK4fLXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAqgSURBVHgBpVhrjFXVFf7OPuee+5g7M8yLx8hjhsxQqYKEFGiNVYtarNY+YqIS0/5p2qY/mppKjG2kQqkxak3qn7b8qAq1iCXVkhRpaQXKqzhFKagMrxkYYGZg7jzgztz3OWf323ufe2doQKie5N57Xnvvtb71rW+tfS3JAx9zSAT6E+grB4LfYvwhYEE/tfSpUBcIwhdE+YVrHOJaL1jhWpJnytzxKbm0Zey3+EDC0++VX9BGB1Z48kmNkJWpOK/Djw1bLVDkPY8GeCVkebfjbB+yJZ8TOZATJr22/9djhBWElohKCETRhyUEPBohnCj+eKIbL+7cDst1icME4zVi0oTlmlh/zCsh0BU49YsRC8ViAXbMwcZjPXhp9z5Uz52HPB/ZfDcIh0B6/PH19XVE4+pGWBNPtEWMufThJlxsPHISz/1zH5LzFiKXp2H5Ik51nWZAYHgioE1SxLwOICA8oML9SlD5KxWWilg+zxUgUuWIjdc6u7Bqz37csPhW5MeKSHCGEkN01+Nr8OzfdmirA1/RRmWSQTKMEOcoL2tWLa8lKl5PzKYJDPdsHwUvC2FFsOHdQ3hm6w603HY7Lo6OwY3EUPAlfBkg2dqC1S+/juWrnsdQgUSlYQER0kZw9UDxqBJdEXpq1hKGyeOg6YWVNvCWT++zpTRiThwbOj7EL/ccxI1LlyF9YQSRiI18Pot6O4o6x0ZkLIXm1tnYcz6LJd9ZgV1dXRAxl2RhSDiPbTM4Za6r9aRd0RghLiOBiqP5BCgS1jxq3Dqs3/sennpnD6YuvQfDlzKoEjYz1cek9DAeW3wTam0bG198Bn4hj1z1JNjtbfjmiiew5s9bGFHmiYJASkNdOZGq6pwZJwP9dPxmEGh8gsDjTwRv7T2IFW/vRNtDjyA9lkMMJQg/B39oBC8suw2LSFQ1JuCYncNp/GjtG+hLXUBjjcDQyT4sWzgPv3nsu6hRxvhc0DF0HaeAZ+LgYaI2OfDyCiIXWw91YvnL63DTww8heymHKg7NU6QKwyk8vXSJMUCGRnOWW+tr8OSjD6B99myk8g4m8/fvh/6Dh1c/i0s+pd1xKgGvZEGZwIa9BiYlzQ51YPfxM/jak6txx/e/h0uFLElIhbTyCAaG8JNbF+POmjiklmsTUIewRvi5e/oUfH7BPNxy2x04k06haXYr3usZwCNP/SJc2tZCJlXaheSsZIcoG8GL/kwODz+1Bq33fR2xaAKyUEAuKGD0wjk8fudC3N80CX4uo4rGBHm2tUdNvPGl9mkQ0QiW3Hc/+hiiWXNuxN7uU/jp7zfyDTJDkVLLqilGoRFlrRWaqasZgrFYHLNb21AkD7yIC1mUuGdKM77RVINAqaYbNUSzPB0KT0sVx8sS7p7SyND5SE6dhUVLvohz585j1sLPYe3mLejoPg3LEroWaU1VRpRLlIpDwPgeGkxj064O1DbfgJrGepSKRdh+BF4ui28vbONQ8iXqwrcdUtRgWC4Rvs4+Bwn+PHpTK84e70Lss3NRf2M7xoYuoXFGK364dr0JhCdNmyBVClfgFFpgXvvrO4gkqhGtrkFWlCBJJocTJ5kBLSxUtkKMszihN2XxGa9V5nsmgamillwseJg9f752NBZPojs1jH+f7oXFkix0NKyyWAU6FOmih227dmPKtClwKTS+ekKRKRRymNHQiHj4trSNnNuyLMjCEExiXI2pHUqkvHwebrIK8fo6fT/mMu137jX4h0OFqTdCNy09vecwmKFE2y5KKqdpAH84r28KkhrkebySuqxoL8K88ixD6jAozFxGnJ8opT3re6id0oQM564iwh1HPoSnKWiQFBOL1mBmjLWCclzyjJW+adcisShOD/ajJMvgSy3rUnoV3Qs0RiXNMj3UoSMUKFVVVVoi4sBmaAUJ3XtxBEXfL1sdSpeyigOGPGiZdaJRjI5chKvynwT0WcJzNO7YWIE3XI2I0PgEegFVwBylAkGJRaukJz7QdxFBPIaiqhuc0y8VtWOC/FL3pGWFGlHRT3M41HiPKDgsSCWikh1KIe5SXJSUJxLY9P4x3cAoGKTHrCFHVKAiKrVVnab6MXfRnfewo/MkYvX1DEkAl+/lLqaN4fQg8Mv6EiKhcty0ckA9U0/Z5TGGDQxB/4mjiEbZPSreRpJ4l8KzvmdIt21eYOl3bTMJ64IqVA4GCftLBz7CMI1W00ZohPB8ZC6kUEVk8kSkiiHR3gtDbCExTukYIRIko3IqSetTXSdZrjM6CxwakW+cilcOHsS6I12QeqIQSJU0XPw468rPd+3D/vQoZGMjZK6IukQVTh09yQa5qCksGFZF1nFpYCht5YuhKKY3T0VzMqYbamk5RCOOo7v3YMmy+9BDFBwnhvjkWXi1ewBvnk1h0Yxm3Dy1lsVJ4kBXDzrPD6IUq0Z1XSOy5IZVFUOEYR384H0kExEU6XIhlcIDCxchzpVVu6jU0wm0SJkS3pxM4gtz52DLsTNI1tYiTtzHzvai+4PDmDHvFvSPjLDNd+A2NmGQqbrt3AC2Hj0FSVFymXpiWgvDEmheTaIeKGJ3/msvIl6BulGlaaxCs3TBHIY80PqgEkL45WCEBF3+lXuRSfUiGVNZ4eGGhgac7OhA/0eHMX1SDbssNcBjxWQgq5KwKe/Rhsls+9lp5AvkgU8vJerJtRPbtyPTewYNdQ1shhV3qLyc897FCzSpda+jtMbChLacJ7e3z8Q9C27BEHUB0TgKFJhmkqyL7X3nP7ajnojVMt/jttB9hBcEugDaRKaakW0iAs7YJezbshn53tOYXJfEKOtOIpbAhVNd+PG3HtIIWbqKq5YvMJ1VQBorJltKPCjJ+1npHnjyaTTMnQ+nWNL10eazUXqap8o1tbWjoWUWBGMeo7xb3BSVMhl232PoO3Ua58/wheymPOAAAAAElFTkSuQmCC"
                alt="Ora" class="w-10 h-10 object-contain">
        </div>
        <nav class="flex-1 overflow-y-auto flex flex-col items-center gap-0 bg-[#297A88]">
            <!-- Dashboard (Active) -->
            <a href="#" class="w-full h-20 flex items-center justify-center bg-[#066070] transition-all shadow-inner">
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAC0SURBVHgB7ZRBCsMgFER/y4dkkX3WHq0naY/QI+Ro3QsqgqKCtFrIoiudQOgieSBuRgf8zlyMMe9hGKiFtXaZ5/kmpXxM03Rv6VNKpJQSXC8fx7GlJ+fcd2fmLv3KlXbmNPi/ARNI/X4hhKYuxrjNwHv/LGvp0QohXrBBOWTKZnr1sAGcZAJBk8zrMFrknGkLrLUWndrud/8xqJOmHWG0rgkErmuUs+wOYAAnGa5rNMloXX8AcOJjGvOkhXMAAAAASUVORK5CYII="
                    alt="Dashboard" class="w-6 h-6">
            </a>
            <!-- Report -->
            <a href="#"
                class="w-full h-20 flex items-center justify-center text-white/70 hover:bg-[#066070]/30 transition-all group">
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAXCAYAAAAP6L+eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAHPSURBVHgBrVVZboJQFL0gzn6QOEV/KjtwB9UVtEvQHXQHxZXYrqDtClhC3QHqj3GKxCHO0nNpIGgUkyfn58HjcjjvDgciH2azmbFer22sbQqAaZoVy7Jsjh2NRo1rMbL/JhqNUiKRoEgkQvcQj8ed2FuQ+OuqqrYlSaokk0k1FoupUGLtdjsriDidTlcURaHFYmHh3e5yufwulUotL2A6nf7aIeB4PNr9fr/h8iqpVKrKF8hr53Q6dUgASMtrJpNRwfWM2w+H2H243W5/cBSdBIBC1rCo/j2PGAV7QYWfSABcl8s9jzifz3NKqhQSPGLuBCwWCQCnrUD1+SY3OWMwGOgkCOTYZI7JZOINlkwhAK1Gm83GWV0oFAKy2ax2uReKYheY4ipPMl+HopiBGr3ncjl9v99baNt6KMRQWUN+e5hcYr8B+dfDqWCl5XLZgDM+j8fjJhcRhvT5ULsxKdR5JjQcDtucZ34mrNjNKVunDz1N0/6NTESxX6lP7dn70mq1smF3NJ/PuwjoXiM6HA5UKBTq15RywTBxrWKxeEbs/OfumTj+EjbHcvVhr4FKXSiY8yaOpaOqNy0Tij1zkmU5WKkIuOJImYF2MtBab0GxfwMGnz5RbhevAAAAAElFTkSuQmCC"
                    alt="Report" class="w-6 h-6 opacity-70 group-hover:opacity-100 transition-opacity">
            </a>
            <!-- Calendar -->
            <a href="#"
                class="w-full h-20 flex items-center justify-center text-white/70 hover:bg-[#066070]/30 transition-all group">
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAYCAYAAAAVibZIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAG0SURBVHgBtZXLbcJAEIZnwbyFZHGCm91BSiAduATSQToIHSQdxFRAOiAlUACSVxzgAAiDeL+c+S07OE7sSMZ80nof/j3amdlZEwWYTqfmdrt11uu1Y1nWA8UwHA4NaNHG43E7+E4JTnK5HBWLRTqdTpiqcUZZq0L7FwKP+Xz+ks1mm9weyuWyerlcaLPZ9IUQdoxdrVKpaBiwZ5K/kdx3Go2GSYvF4tVJifP57IxGo2eB+PHuXJc9txORz+cpk8lgk1LBwHeBw/BICanX65YfYyX0TqMUEDgSUVlMAtzP0B34dp9jau92uw9KSLVabSFZLnAf2LZt0Q0E7fxyn0vVWK1WPbTBYGBgjYVdzCeTSTdKEyScfUJVcaU0vWkHj0KhYHjlK6M0sUYPhwNxbH+s7fd7t+eKidTEGuWaf+Nmejtya5+LQv9PE2vUQ/N6yQ0fqXS9tWSE5ko4+7yrtn9BcBJaSTT3PfyBnfc5ISbGHC+JfrlcmlwcSJAdpQkbSf3wK7jlQalUUnGYKSGKEnAahpwU4VC9C/5rarVarceXgUY3cjweP2ez2ZPwF2CcbkTXdYn+C38a9HUI1r8wAAAAAElFTkSuQmCC"
                    alt="Calendar" class="w-6 h-6 opacity-70 group-hover:opacity-100 transition-opacity">
            </a>
        </nav>

    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col overflow-hidden relative">

        <!-- Header & Global Filters (PRD 1.2) -->
        <header class="bg-white border-b border-gray-200 z-10 shadow-sm flex-shrink-0">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between px-6 py-3 gap-4">
                <div>
                    <h1 class="text-xl font-bold text-gray-900">OraNutrition å†…éƒ¨æµç¨‹ä¸å®¢æˆ·æ´å¯Ÿæ€»è§ˆ</h1>
                    <p class="text-xs text-gray-500">ä¸Šæ¬¡æ›´æ–°: 2024-11-28 09:00 AM</p>
                </div>

                <div class="flex flex-wrap gap-2 items-center">
                    <!-- Date Range -->
                    <select
                        class="text-xs border-gray-300 rounded shadow-sm focus:border-ora-primary py-1.5 px-2 bg-gray-50">
                        <option>ğŸ“… æ—¶é—´èŒƒå›´: æœ¬å­£åº¦ (Q4)</option>
                        <option>ğŸ“… 2024-06-01 ~ 2024-08-31 (Previous)</option>
                    </select>
                    <!-- Brand -->
                    <select
                        class="text-xs border-gray-300 rounded shadow-sm focus:border-ora-primary py-1.5 px-2 bg-gray-50">
                        <option>å“ç‰Œ: å…¨éƒ¨</option>
                        <option>Little Umbrella</option>
                        <option>PowerGums</option>
                    </select>
                    <!-- Line Category -->
                    <select
                        class="text-xs border-gray-300 rounded shadow-sm focus:border-ora-primary py-1.5 px-2 bg-gray-50">
                        <option>äº§çº¿ç±»å‹: å…¨éƒ¨</option>
                        <option>Gummies</option>
                        <option>Powder</option>
                    </select>
                    <!-- Status Filter (Hidden logic: Default ALL for Part 1/3) -->
                    <button
                        class="bg-ora-primary text-white px-3 py-1.5 rounded text-xs hover:bg-teal-700 transition shadow-sm font-bold">
                        <i class="fa-solid fa-rotate-right mr-1"></i> åˆ·æ–°æ•°æ®
                    </button>
                    <!-- User Profile -->
                    <div class="ml-2 pl-2 border-l border-gray-200 flex items-center gap-2">
                        <div
                            class="w-8 h-8 rounded-full bg-ora-primary/20 text-ora-primary flex items-center justify-center text-xs font-bold ring-2 ring-white shadow-sm cursor-pointer hover:ring-ora-primary/50 transition">
                            JD
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Scrollable Area -->
        <div id="main-scroller" class="flex-1 overflow-y-auto bg-gray-50 p-6 scroller space-y-8 scroll-smooth">

            <!-- ========================================== -->
            <!-- PART 1: INTERNAL EXCEPTION RADAR (PRD 2) -->
            <!-- ========================================== -->
            <section>
                <div class="flex items-center gap-2 mb-4">
                    <h2
                        class="text-base font-bold text-gray-800 uppercase tracking-wide border-l-4 border-ora-primary pl-3">
                        Part 1. å†…éƒ¨å¼‚å¸¸é›·è¾¾ (Internal Exception Radar)</h2>
                    <span class="text-xs text-gray-400 italic ml-2"><i class="fa-solid fa-circle-info mr-1"></i>Click
                        cards to filter details</span>
                </div>

                <!-- Widget 1A: KPI Summary Bar (PRD 2.1) -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <!-- Card 1: Lead Time Breach -->
                    <div class="card p-4 border-l-4 border-red-500 cursor-pointer hover:shadow-md transition kpi-card"
                        id="card-lead-time" onclick="toggleKpiFilterP1('card-lead-time', 'leadtime')"
                        title="Based on 142 contracts">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="text-xs text-gray-500 uppercase font-bold">æ•´ä½“å‘¨æœŸè¶…å‡ºå†…éƒ¨ç›®æ ‡</div>
                                <div class="text-2xl font-bold text-red-600 mt-1">18 <span
                                        class="text-sm text-gray-400 font-normal">/ 142</span></div>
                            </div>
                            <div class="bg-red-100 p-2 rounded-full text-red-500"><i class="fa-solid fa-clock"></i>
                            </div>
                        </div>
                        <div class="mt-2 text-xs text-red-500 font-medium"><i class="fa-solid fa-arrow-up"></i> 5 vs
                            last week</div>
                        <div class="mt-1 text-[10px] text-gray-400">Stage SLA > ç›®æ ‡</div>
                    </div>

                    <!-- Card 2: Payment Blocked -->
                    <div class="card p-4 border-l-4 border-orange-400 cursor-pointer hover:shadow-md transition kpi-card"
                        id="card-payment" onclick="toggleKpiFilterP1('card-payment', 'money')"
                        title="Based on 45 active contracts">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="text-xs text-gray-500 uppercase font-bold">æ”¶æ¬¾ç¯èŠ‚æœ‰é˜»å¡</div>
                                <div class="text-2xl font-bold text-orange-500 mt-1">8 <span
                                        class="text-sm text-gray-400 font-normal">Contracts</span></div>
                            </div>
                            <div class="bg-orange-100 p-2 rounded-full text-orange-500"><i
                                    class="fa-solid fa-hand-holding-dollar"></i></div>
                        </div>
                        <div class="mt-2 text-xs text-orange-500 font-medium">High Priority</div>
                        <div class="mt-1 text-[10px] text-gray-400">æ¬¾é¡¹å¾…ç¡®è®¤ > 3 å¤©</div>
                    </div>

                    <!-- Card 3: Material Risk -->
                    <div class="card p-4 border-l-4 border-yellow-400 cursor-pointer hover:shadow-md transition kpi-card"
                        id="card-material" onclick="toggleKpiFilterP1('card-material', 'materials')"
                        title="Based on 45 active contracts">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="text-xs text-gray-500 uppercase font-bold">ç‰©æ–™å‡†å¤‡å­˜åœ¨é£é™©</div>
                                <div class="text-2xl font-bold text-yellow-600 mt-1">12 <span
                                        class="text-sm text-gray-400 font-normal">Contracts</span></div>
                            </div>
                            <div class="bg-yellow-100 p-2 rounded-full text-yellow-600"><i
                                    class="fa-solid fa-boxes-stacked"></i></div>
                        </div>
                        <div class="mt-2 text-xs text-gray-500 font-medium">Requires Attention</div>
                        <div class="mt-1 text-[10px] text-gray-400">ç‰©æ–™æœªåˆ°+ä¸´è¿‘æ’äº§</div>
                    </div>

                    <!-- Card 4: Data Issues -->
                    <div class="card p-4 border-l-4 border-gray-400 cursor-pointer hover:shadow-md transition kpi-card"
                        id="card-data" onclick="toggleKpiFilterP1('card-data', 'data_issue')"
                        title="Based on all records">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="text-xs text-gray-500 uppercase font-bold">æ•°æ®è®°å½•éœ€è¡¥å……</div>
                                <div class="text-2xl font-bold text-gray-600 mt-1">15 <span
                                        class="text-sm text-gray-400 font-normal">Records</span></div>
                            </div>
                            <div class="bg-gray-100 p-2 rounded-full text-gray-600"><i class="fa-solid fa-database"></i>
                            </div>
                        </div>
                        <div class="mt-2 text-xs text-red-500 font-medium">Affects Forecast</div>
                        <div class="mt-1 text-[10px] text-gray-400">å­—æ®µç¼ºå¤±/å¼‚å¸¸</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                    <!-- Widget P1-B: Key Contracts Stage Overview (Merged 1B & 1C) -->
                    <div id="widget-p1b" class="card lg:col-span-2">
                        <div class="card-header">
                            <div class="flex items-center gap-4">
                                <h3 class="card-title"><i class="fa-solid fa-list-check text-ora-primary"></i> P1-B.
                                    å…³é”®è®¢å•é˜¶æ®µæ€»è§ˆ (Key Contracts)</h3>
                                <div class="flex bg-gray-100 rounded p-0.5 space-x-1">
                                    <button onclick="switchView('p1b', 'list')" id="btn-p1b-view-list"
                                        class="px-2 py-0.5 text-xs rounded bg-white shadow-sm font-bold text-gray-800 border border-gray-200">åˆ—è¡¨</button>
                                    <button onclick="switchView('p1b', 'graph')" id="btn-p1b-view-graph"
                                        class="px-2 py-0.5 text-xs rounded text-gray-500 hover:text-gray-800">å›¾è¡¨</button>
                                </div>
                            </div>
                            <!-- Internal Filters -->
                            <div class="flex space-x-2 text-xs">
                                <span class="text-gray-400 self-center">Filter:</span>
                                <button onclick="filterP1B('all')" class="tab-btn tab-active"
                                    id="btn-p1b-all">å…¨éƒ¨</button>
                                <button onclick="filterP1B('blocker')" class="tab-btn tab-inactive"
                                    id="btn-p1b-blocker">å¾…è§£å†³ (Blocker)</button>
                                <button onclick="filterP1B('delay')" class="tab-btn tab-inactive"
                                    id="btn-p1b-delay">ä¸¥é‡è¶…æ—¶</button>
                            </div>
                        </div>

                        <!-- List View -->
                        <div class="p-0 overflow-x-auto flex-1" id="p1b-view-list">
                            <table class="w-full text-left text-xs">
                                <thead class="bg-gray-50 text-gray-500 uppercase border-b border-gray-200">
                                    <tr>
                                        <th class="px-4 py-3 font-semibold">åˆåŒ / å“ç‰Œ</th>
                                        <th class="px-4 py-3 font-semibold">å½“å‰é˜¶æ®µ</th>
                                        <th class="px-4 py-3 font-semibold">æœ€ä¸¥é‡é˜¶æ®µ (Delay)</th>
                                        <th class="px-4 py-3 font-semibold">çŠ¶æ€ / åŸå› </th>
                                        <th class="px-4 py-3 font-semibold text-right">æ—¶é—´ (ç­¾çº¦/æ›´æ–°)</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100" id="p1b-tbody">
                                    <!-- Mock Data: Blocker - Money -->
                                    <tr class="hover:bg-gray-50 row-blocker row-money">
                                        <td class="px-4 py-3">
                                            <div class="font-bold text-gray-800">C2411-003</div>
                                            <div class="text-[10px] text-gray-500">Little Umbrella</div>
                                        </td>
                                        <td class="px-4 py-3"><span
                                                class="bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-[10px]">S1
                                                æ¬¾é¡¹</span></td>
                                        <td class="px-4 py-3"><span class="text-red-500 font-bold">+45d</span></td>
                                        <td class="px-4 py-3"><span
                                                class="bg-red-50 text-red-600 px-2 py-0.5 rounded border border-red-100 text-[10px]">æ¬¾é¡¹æœªåˆ°</span>
                                        </td>
                                        <td class="px-4 py-3 text-right">
                                            <div class="font-bold">45d</div>
                                            <div class="text-[10px] text-gray-400">2d ago</div>
                                        </td>
                                    </tr>
                                    <!-- Mock Data: Blocker - Materials -->
                                    <tr class="hover:bg-gray-50 row-blocker row-materials">
                                        <td class="px-4 py-3">
                                            <div class="font-bold text-gray-800">C2411-008</div>
                                            <div class="text-[10px] text-gray-500">PowerGums</div>
                                        </td>
                                        <td class="px-4 py-3"><span
                                                class="bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-[10px]">S2
                                                ç‰©æ–™</span></td>
                                        <td class="px-4 py-3"><span class="text-orange-500 font-bold">+20d</span></td>
                                        <td class="px-4 py-3"><span
                                                class="bg-orange-50 text-orange-600 px-2 py-0.5 rounded border border-orange-100 text-[10px]">ç‰©æ–™æœªé½</span>
                                        </td>
                                        <td class="px-4 py-3 text-right">
                                            <div class="font-bold">20d</div>
                                            <div class="text-[10px] text-gray-400">1d ago</div>
                                        </td>
                                    </tr>
                                    <!-- Mock Data: SLA Breach (Lead Time) -->
                                    <tr class="hover:bg-gray-50 row-delay row-leadtime">
                                        <td class="px-4 py-3">
                                            <div class="font-bold text-gray-800">C2410-001</div>
                                            <div class="text-[10px] text-gray-500">Vitality</div>
                                        </td>
                                        <td class="px-4 py-3"><span
                                                class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-[10px]">S4
                                                ç”Ÿäº§</span></td>
                                        <td class="px-4 py-3"><span class="text-red-500 font-bold">+15d</span></td>
                                        <td class="px-4 py-3"><span class="text-gray-500 text-[10px]">è¶…å‡ºå†…éƒ¨ç›®æ ‡</span></td>
                                        <td class="px-4 py-3 text-right">
                                            <div class="font-bold">60d</div>
                                            <div class="text-[10px] text-gray-400">Active</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="p-2 text-center text-xs text-gray-400 border-t border-gray-100">
                                åˆ—è¡¨æŒ‰ä¸¥é‡ç¨‹åº¦æ’åºï¼Œä¼˜å…ˆæ˜¾ç¤ºå¾…è§£å†³äº‹é¡¹ã€‚ä»…å±•ç¤ºå‰ 20 ä»½æœ€éœ€è¦å…³æ³¨çš„è®¢å•ã€‚
                            </div>
                        </div>

                        <!-- Graph View (Matrix) -->
                        <div id="p1b-view-graph" class="hidden p-4 overflow-x-auto">
                            <div class="min-w-[500px]">
                                <!-- Header -->
                                <div class="grid grid-cols-6 gap-1 mb-2 text-xs font-bold text-gray-500 text-center">
                                    <div class="text-left pl-2">åˆåŒ</div>
                                    <div>S1 æ¬¾é¡¹</div>
                                    <div>S2 ç‰©æ–™</div>
                                    <div>S3 ç­‰å¾…</div>
                                    <div>S4 ç”Ÿäº§</div>
                                    <div>S5 å‘è´§</div>
                                </div>
                                <!-- Row 1 -->
                                <div class="grid grid-cols-6 gap-1 mb-1 text-xs">
                                    <div class="flex flex-col justify-center pl-2">
                                        <span class="font-bold">C2411-003</span>
                                        <span class="text-[10px] text-gray-400">Little Umbrella</span>
                                    </div>
                                    <div
                                        class="bg-red-500 text-white flex flex-col items-center justify-center p-1 rounded">
                                        <span class="font-bold">+45</span>
                                        <span class="text-[8px]">æ¬¾é¡¹æœªåˆ°</span>
                                    </div>
                                    <div class="bg-gray-100 rounded"></div>
                                    <div class="bg-gray-100 rounded"></div>
                                    <div class="bg-gray-100 rounded"></div>
                                    <div class="bg-gray-100 rounded"></div>
                                </div>
                                <!-- Row 2 -->
                                <div class="grid grid-cols-6 gap-1 mb-1 text-xs">
                                    <div class="flex flex-col justify-center pl-2">
                                        <span class="font-bold">C2411-008</span>
                                        <span class="text-[10px] text-gray-400">PowerGums</span>
                                    </div>
                                    <div
                                        class="bg-green-500 text-white flex items-center justify-center rounded font-bold">
                                        OK</div>
                                    <div
                                        class="bg-orange-500 text-white flex flex-col items-center justify-center p-1 rounded">
                                        <span class="font-bold">+20</span>
                                        <span class="text-[8px]">ç‰©æ–™æœªé½</span>
                                    </div>
                                    <div class="bg-gray-100 rounded"></div>
                                    <div class="bg-gray-100 rounded"></div>
                                    <div class="bg-gray-100 rounded"></div>
                                </div>
                                <!-- Row 3 -->
                                <div class="grid grid-cols-6 gap-1 mb-1 text-xs">
                                    <div class="flex flex-col justify-center pl-2">
                                        <span class="font-bold">C2410-001</span>
                                        <span class="text-[10px] text-gray-400">Vitality</span>
                                    </div>
                                    <div
                                        class="bg-green-500 text-white flex items-center justify-center rounded font-bold">
                                        OK</div>
                                    <div
                                        class="bg-green-500 text-white flex items-center justify-center rounded font-bold">
                                        OK</div>
                                    <div
                                        class="bg-green-500 text-white flex items-center justify-center rounded font-bold">
                                        OK</div>
                                    <div
                                        class="bg-red-400 text-white flex flex-col items-center justify-center p-1 rounded">
                                        <span class="font-bold">+15</span>
                                        <span class="text-[8px]">ç”Ÿäº§å»¶è¿Ÿ</span>
                                    </div>
                                    <div class="bg-gray-100 rounded"></div>
                                </div>
                            </div>
                            <div class="mt-4 text-xs text-gray-400 text-center">
                                å½©è‰²æ ¼å­è¡¨ç¤ºè¯¥é˜¶æ®µæ¯”å†…éƒ¨ç›®æ ‡å¤šç”¨çš„å¤©æ•°ã€‚
                            </div>
                        </div>
                    </div>

                    <!-- Widget P1-C: Zombie & Inventory (Renamed from 1D) -->
                    <div id="widget-p1c" class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fa-solid fa-skull text-gray-500"></i> P1-C. åƒµå°¸åˆåŒä¸åº“å­˜</h3>
                            <div class="flex bg-gray-100 rounded p-0.5 space-x-1">
                                <button onclick="toggleZombieView('contracts')" id="btn-zombie-contracts"
                                    class="px-3 py-1 text-xs rounded bg-white shadow-sm font-bold text-gray-800 border border-gray-200">åœæ»ä¸­çš„åˆåŒ</button>
                                <button onclick="toggleZombieView('inventory')" id="btn-zombie-inventory"
                                    class="px-3 py-1 text-xs rounded text-gray-500 hover:text-gray-800">æ»ç•™æˆå“/åŠæˆå“</button>
                            </div>
                        </div>
                        <div class="p-4 flex-1 overflow-y-auto">
                            <!-- View: Contracts -->
                            <div id="view-zombie-contracts" class="space-y-3">
                                <div class="text-xs text-gray-400 mb-2">è¶…è¿‡ 45 å¤©æ— æ›´æ–° (Inactive > 45d)</div>
                                <div class="space-y-2">
                                    <div>
                                        <div class="flex justify-between text-xs mb-1">
                                            <span class="font-bold text-gray-700">C2408-002 (Vitality)</span>
                                            <span class="text-red-500 font-bold">120d</span>
                                        </div>
                                        <div class="w-full bg-gray-100 rounded-full h-2" title="120d (Inactive)">
                                            <div class="bg-gray-400 h-2 rounded-full" style="width: 100%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-xs mb-1">
                                            <span class="font-bold text-gray-700">C2409-015 (Muscle)</span>
                                            <span class="text-red-500 font-bold">95d</span>
                                        </div>
                                        <div class="w-full bg-gray-100 rounded-full h-2" title="95d (Inactive)">
                                            <div class="bg-gray-400 h-2 rounded-full" style="width: 80%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- View: Inventory -->
                            <div id="view-zombie-inventory" class="hidden space-y-3">
                                <div class="text-xs text-gray-400 mb-2">å‘è´§é€¾æœŸè¶…è¿‡ 7 å¤© (Overdue > 7d)</div>
                                <ul class="space-y-2">
                                    <li class="flex justify-between items-center p-2 bg-red-50 rounded border border-red-100"
                                        title="Produced: 5000, Shipped: 0, Stuck: 5000">
                                        <div>
                                            <div class="text-xs font-bold text-gray-800">C2410-001 (Gummies)</div>
                                            <div class="text-[10px] text-red-500">Produced but not shipped (15d)</div>
                                        </div>
                                        <div class="text-xs font-bold text-gray-800">5k Units</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-footer">Showing Top 5 by Inactive/Overdue Days</div>
                    </div>

                    <!-- Widget P1-D: Data Quality (Renamed from 1E) -->
                    <!-- Widget P1-D: Data Quality Monitor (Left-Right Layout) -->
                    <div id="widget-p1d"
                        class="card bg-white border border-gray-200 shadow-sm rounded-lg lg:col-span-3 flex flex-col h-96">
                        <div
                            class="card-header flex justify-between items-center mb-2 px-4 py-3 border-b border-gray-100">
                            <h3 class="font-bold text-gray-800 text-lg flex items-center gap-2">
                                <i class="fas fa-database text-purple-600"></i> æ•°æ®è®°å½•å®Œæ•´åº¦ (Data Quality)
                            </h3>
                            <span class="text-xs text-gray-500">Last Update: 10 mins ago</span>
                        </div>

                        <div class="flex flex-1 overflow-hidden p-4 gap-4">
                            <!-- Left: Charts (50%) -->
                            <div class="w-1/2 flex flex-col justify-center">
                                <div class="flex flex-1 gap-2 items-center justify-center">
                                    <!-- Chart 1: Good vs Bad -->
                                    <div class="w-1/2 relative h-40">
                                        <canvas id="dataQualityGoodBad"></canvas>
                                        <div
                                            class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                            <div class="text-center">
                                                <span class="text-2xl font-bold text-gray-800">92%</span><br>
                                                <span class="text-xs text-gray-500">å®Œæ•´åº¦</span>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Chart 2: Issue Types -->
                                    <div class="w-1/2 relative h-40">
                                        <canvas id="dataQualityChart"></canvas>
                                    </div>
                                </div>
                                <div class="mt-2 text-xs text-gray-500 text-center bg-gray-50 p-2 rounded">
                                    <i class="fas fa-info-circle mr-1"></i>å·¦ä¾§å±•ç¤ºæ•´ä½“è®°å½•å®Œæ•´åº¦ï¼Œå³ä¾§å±•ç¤ºé—®é¢˜ç±»å‹åˆ†å¸ƒã€‚ä¸€æ¡è®°å½•å¯èƒ½åŒæ—¶åŒ…å«å¤šç§é—®é¢˜ã€‚
                                </div>
                            </div>

                            <!-- Right: Detail List (50%) -->
                            <div
                                class="w-1/2 flex flex-col bg-white border border-gray-100 rounded-lg shadow-sm h-full">
                                <div
                                    class="px-3 py-2 border-b border-gray-100 flex justify-between items-center bg-gray-50 rounded-t-lg">
                                    <span class="font-bold text-xs text-gray-700">é—®é¢˜åˆåŒåˆ—è¡¨ (Issue List)</span>
                                    <span id="p1d-current-filter"
                                        class="text-xs px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full font-medium">å½“å‰ç­›é€‰:
                                        å…¨éƒ¨é—®é¢˜</span>
                                </div>
                                <div class="flex-1 overflow-y-auto p-0">
                                    <table class="w-full text-left border-collapse">
                                        <thead class="sticky top-0 bg-gray-50 text-xs font-semibold text-gray-500 z-10">
                                            <tr>
                                                <th class="p-2 border-b">åˆåŒ/äº§å“ (Contract)</th>
                                                <th class="p-2 border-b">é—®é¢˜ (Issue)</th>
                                                <th class="p-2 border-b">æ›´æ–° (Update)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="p1d-tbody" class="text-xs divide-y divide-gray-100">
                                            <!-- Mock Data Rows -->
                                            <tr class="hover:bg-gray-50 transition-colors row-issue-date">
                                                <td class="p-2">
                                                    <div class="font-medium text-gray-800">C-2024-001</div>
                                                    <div class="text-gray-500 scale-90 origin-left">Gummies</div>
                                                </td>
                                                <td class="p-2 text-red-600"><i
                                                        class="fas fa-calendar-times mr-1"></i>ç¼ºå°‘å‘è´§æ—¥æœŸ</td>
                                                <td class="p-2 text-gray-500">10m ago<br>by System</td>
                                            </tr>
                                            <tr class="hover:bg-gray-50 transition-colors row-issue-qty">
                                                <td class="p-2">
                                                    <div class="font-medium text-gray-800">C-2024-005</div>
                                                    <div class="text-gray-500 scale-90 origin-left">Powder</div>
                                                </td>
                                                <td class="p-2 text-orange-600"><i
                                                        class="fas fa-balance-scale-right mr-1"></i>æ•°é‡ä¸ä¸€è‡´</td>
                                                <td class="p-2 text-gray-500">2h ago<br>by John</td>
                                            </tr>
                                            <tr class="hover:bg-gray-50 transition-colors row-issue-date">
                                                <td class="p-2">
                                                    <div class="font-medium text-gray-800">C-2024-008</div>
                                                    <div class="text-gray-500 scale-90 origin-left">Liquids</div>
                                                </td>
                                                <td class="p-2 text-red-600"><i
                                                        class="fas fa-calendar-times mr-1"></i>ç¼ºå°‘å‘è´§æ—¥æœŸ</td>
                                                <td class="p-2 text-gray-500">1d ago<br>by System</td>
                                            </tr>
                                            <tr class="hover:bg-gray-50 transition-colors row-issue-other">
                                                <td class="p-2">
                                                    <div class="font-medium text-gray-800">C-2024-012</div>
                                                    <div class="text-gray-500 scale-90 origin-left">Capsules</div>
                                                </td>
                                                <td class="p-2 text-gray-600"><i
                                                        class="fas fa-exclamation-circle mr-1"></i>ä»˜æ¬¾æ—¥æœŸç¼ºå¤±</td>
                                                <td class="p-2 text-gray-500">3d ago<br>by Finance</td>
                                            </tr>
                                            <tr class="hover:bg-gray-50 transition-colors row-issue-logic">
                                                <td class="p-2">
                                                    <div class="font-medium text-gray-800">C-2024-015</div>
                                                    <div class="text-gray-500 scale-90 origin-left">Gummies</div>
                                                </td>
                                                <td class="p-2 text-red-600"><i class="fas fa-clock mr-1"></i>æ—¶é—´é¡ºåºå¼‚å¸¸
                                                </td>
                                                <td class="p-2 text-gray-500">5m ago<br>by System</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <!-- Empty State (Hidden by default) -->
                                    <div id="p1d-empty-state"
                                        class="hidden flex flex-col items-center justify-center h-full text-gray-400">
                                        <i class="fas fa-check-circle text-4xl text-green-500 mb-2"></i>
                                        <p class="text-sm">è®°å½•å®Œæ•´ Â· æ— éœ€è¡¥å……</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div
                            class="px-4 py-2 border-t border-gray-100 text-xs text-gray-400 flex justify-between items-center bg-gray-50 rounded-b-lg">
                            <span><i class="fas fa-info-circle mr-1"></i>å·¦ä¾§å±•ç¤ºæ•´ä½“æ•°æ®è®°å½•çš„å®Œæ•´åº¦ï¼Œå³ä¾§åˆ—å‡ºå…·ä½“æœ‰é—®é¢˜çš„åˆåŒä¸äº§å“ï¼Œä¾¿äºå¿«é€Ÿå›æº¯å¹¶è¡¥å…¨ä¿¡æ¯ã€‚å½“å‰
                                Demo ç¯å¢ƒä½¿ç”¨çš„æ˜¯ç¤ºä¾‹æ•°æ®ã€‚</span>
                        </div>
                    </div>

                </div>
            </section>

            <!-- ========================================== -->
            <!-- PART 2: PROCESS LEAD TIME (Collapsed)  -->
            <!-- ========================================== -->
            <!-- ========================================== -->
            <!-- PART 2: PROCESS LEAD TIME (PRD 3)      -->
            <!-- ========================================== -->
            <section class="mt-8">
                <div class="flex items-center gap-2 mb-4">
                    <h2
                        class="text-base font-bold text-gray-800 uppercase tracking-wide border-l-4 border-gray-600 pl-3">
                        Part 2. å†…éƒ¨æµç¨‹å‘¨æœŸ (Process Lead Time)</h2>
                    <span class="text-xs text-gray-400">åˆ†æè§†å›¾ (Analysis Mode)</span>
                </div>

                <!-- P0: Contract Entry Latency (Banner) -->
                <div
                    class="bg-orange-50 border border-orange-200 rounded-lg p-3 mb-6 flex items-center justify-between shadow-sm">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-600">
                            <i class="fa-solid fa-stopwatch-20"></i>
                        </div>
                        <div>
                            <div class="text-sm font-bold text-gray-800">åˆåŒå½•å…¥æé†’</div>
                            <div class="text-xs text-gray-600">çº¦ 15% çš„åˆåŒåœ¨ç­¾çº¦å 3 å¤©æ‰å½•å…¥ç³»ç»Ÿã€‚</div>
                        </div>
                    </div>
                    <button
                        class="text-xs bg-white border border-gray-300 px-3 py-1 rounded font-bold text-gray-600 hover:bg-gray-50">æŸ¥çœ‹æ˜ç»†</button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">

                    <!-- P1: Lead Time Waterfall -->
                    <div class="card lg:col-span-2">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fa-solid fa-water text-blue-500"></i> P1. ä»æ”¶é½æ¬¾é¡¹åˆ°å‘è´§çš„å¹³å‡ç”¨æ—¶æ‹†è§£
                            </h3>
                            <span class="text-xs text-gray-400">å¹³å‡å¤©æ•° (Avg Days)</span>
                        </div>
                        <div class="p-4 h-64">
                            <canvas id="p1WaterfallChart"></canvas>
                        </div>
                        <div class="card-footer flex justify-between">
                            <span>æ•´ä½“ä¸­ä½å‘¨æœŸï¼š42 å¤©</span>
                            <span>åŸºäºå·²å®Œæˆçš„åˆåŒ</span>
                        </div>
                        <div class="px-4 pb-2 text-xs text-gray-500">ç›®å‰ä»æ”¶é½è´§æ¬¾åˆ°å‘è´§å¹³å‡çº¦ 42 å¤©ï¼Œå…¶ä¸­ç”Ÿäº§å’Œå‘è´§ä¸¤ä¸ªé˜¶æ®µè€—æ—¶æœ€é•¿ã€‚</div>
                    </div>

                    <!-- P2: Stage SLA Breach Rate -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fa-solid fa-chart-column text-red-500"></i> P2.
                                å„é˜¶æ®µè¶…å‡ºå†…éƒ¨ç›®æ ‡çš„æ¯”ä¾‹</h3>
                        </div>
                        <div class="p-4 h-64 flex flex-col">
                            <div class="flex-1 relative">
                                <canvas id="p2BreachChart"></canvas>
                            </div>
                            <div class="mt-2 text-xs text-gray-600 border-t pt-2">
                                <div class="font-bold mb-1">ä¸»è¦ç“¶é¢ˆ (Top Bottlenecks):</div>
                                <div class="flex justify-between"><span>1. ç‰©æ–™å‡†å¤‡é˜¶æ®µ</span> <span
                                        class="text-red-600 font-bold">68% è¶…å‡ºç›®æ ‡</span></div>
                                <div class="flex justify-between"><span>2. ç”Ÿäº§é˜¶æ®µ</span> <span
                                        class="text-orange-500 font-bold">45% è¶…å‡ºç›®æ ‡</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- P3: Plan Adherence -->
                    <div class="card lg:col-span-2">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fa-solid fa-calendar-check text-green-600"></i> P3.
                                å„äº§çº¿æŒ‰æ—¶äº¤ä»˜æƒ…å†µ</h3>
                        </div>
                        <div class="p-4 h-64">
                            <canvas id="p3AdherenceChart"></canvas>
                        </div>
                        <div class="card-footer">è½¯ç³–å’Œèƒ¶å›Šçš„äº¤ä»˜æœ€ç¨³å®šï¼Œç²‰å‰‚å»¶è¿Ÿè¾ƒå¤šã€‚</div>
                    </div>

                    <!-- P4: Materials vs Production -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fa-solid fa-boxes-stacked text-ora-warning"></i> P4.
                                å¼€å·¥å‰ç‰©æ–™å‡†å¤‡æƒ…å†µ</h3>
                        </div>
                        <div class="p-4 flex flex-col h-full">
                            <div class="h-40 relative">
                                <canvas id="p4MaterialChart"></canvas>
                                <div
                                    class="absolute inset-0 flex items-center justify-center flex-col pointer-events-none">
                                    <span class="text-2xl font-bold text-gray-700">85%</span>
                                    <span class="text-[10px] text-gray-400">å‡†å¤‡å°±ç»ª</span>
                                </div>
                            </div>
                            <div class="text-center text-xs text-gray-500 mt-1 mb-2">å½“å‰çº¦ 85% çš„ç”Ÿäº§æ‰¹æ¬¡åœ¨å¼€å·¥å‰ç‰©æ–™å·²å‡†å¤‡å°±ç»ªã€‚</div>
                            <div class="flex-1 mt-2 overflow-y-auto border-t pt-2">
                                <div class="text-xs font-bold text-gray-700 mb-2">é£é™©æ‰¹æ¬¡ï¼ˆå¼€å·¥æ—¶ç‰©æ–™æœªå®Œå…¨åˆ°ä½ï¼‰</div>
                                <ul class="space-y-1">
                                    <li class="flex justify-between text-xxs text-gray-600"><span>C2411-05
                                            (Gummies)</span> <span class="text-red-500 font-bold">-2d</span></li>
                                    <li class="flex justify-between text-xxs text-gray-600"><span>C2411-08
                                            (Powder)</span> <span class="text-red-500 font-bold">-1d</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- G1: Factory Growth -->
                <div class="card mb-8">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fa-solid fa-arrow-trend-up text-ora-primary"></i> G1. å·¥å‚äº§å‡ºä¸æ•ˆç‡æå‡
                        </h3>
                        <span class="text-xs text-gray-400">å­£åº¦å‡ºè´§è¶‹åŠ¿</span>
                    </div>
                    <div class="p-6 grid grid-cols-1 lg:grid-cols-4 gap-6">
                        <!-- Chart -->
                        <div class="lg:col-span-3 h-64">
                            <canvas id="g1GrowthChart"></canvas>
                            <div class="text-center text-xs text-gray-500 mt-2">Q4 é¢„è®¡å‡ºè´§ 120 ä¸‡ä»¶ï¼Œè¾ƒä¸Šå­£åº¦å¢é•¿ 15%ï¼›å¹³å‡äº¤ä»˜æ—¶é—´æ¯”åˆå§‹é˜¶æ®µç¼©çŸ­çº¦
                                3 å¤©ã€‚</div>
                        </div>
                        <!-- KPIs -->
                        <div class="space-y-4">
                            <div class="bg-gray-50 p-4 rounded border border-gray-100">
                                <div class="text-xs text-gray-500 uppercase font-bold">æœ¬å­£åº¦å‡ºè´§æ€»é‡</div>
                                <div class="text-2xl font-bold text-gray-800 mt-1">1.2M</div>
                                <div class="text-xs text-green-600 mt-1"><i class="fa-solid fa-arrow-up"></i> 15% QoQ
                                </div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded border border-gray-100">
                                <div class="text-xs text-gray-500 uppercase font-bold">å¹³å‡äº¤ä»˜æ—¶é—´</div>
                                <div class="text-2xl font-bold text-gray-800 mt-1">42d</div>
                                <div class="text-xs text-green-600 mt-1"><i class="fa-solid fa-arrow-down"></i> 3d vs
                                    Baseline</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ========================================== -->
            <!-- PART 3: CLIENT & OPPORTUNITY RADAR (PRD 4) -->
            <!-- ========================================== -->
            <section class="pb-10 mt-8">
                <div class="flex items-center gap-2 mb-4">
                    <h2
                        class="text-base font-bold text-gray-800 uppercase tracking-wide border-l-4 border-purple-500 pl-3">
                        Part 3. å®¢æˆ·æ´å¯Ÿä¸æœºä¼š (Client Radar)</h2>
                    <span class="text-xs text-gray-400">Q3 2024 vs Q4 2024</span>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                    <!-- 3A: Client Risk -->
                    <div class="card lg:col-span-2">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fa-solid fa-user-injured text-purple-500"></i>
                                å®¢æˆ·æ´»è·ƒåº¦é£é™© (Dormant & Cooling)
                            </h3>
                        </div>
                        <div class="p-4">
                            <!-- Visual: Bar Chart for Vol Comparison -->
                            <div class="w-full h-40">
                                <canvas id="clientRiskChart"></canvas>
                                <div class="text-center text-xs text-gray-500 mt-2">çº¢è‰²è¡¨ç¤ºæœ¬å­£åº¦å®Œå…¨æ²¡ä¸‹å•ï¼Œæ©™è‰²è¡¨ç¤ºè®¢å•é‡æ˜æ˜¾ä¸‹é™ã€‚</div>
                            </div>
                            <!-- List: Details -->
                            <div class="w-full overflow-x-auto mt-4">
                                <table class="w-full text-left text-xs">
                                    <thead class="bg-gray-50 text-gray-500 uppercase border-b border-gray-200">
                                        <tr>
                                            <th class="px-4 py-2">å“ç‰Œ</th>
                                            <th class="px-4 py-2">çŠ¶æ€</th>
                                            <th class="px-4 py-2 text-right">æœ€è¿‘å‡ å­£å‡ºè´§é‡ (å¯¹æ¯”)</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-100">
                                        <tr>
                                            <td class="px-4 py-2 font-bold">Vitality</td>
                                            <td class="px-4 py-2"><span
                                                    class="bg-red-100 text-red-700 px-2 py-0.5 rounded-full text-xxs">æœ¬å­£æœªä¸‹å•</span>
                                            </td>
                                            <td class="px-4 py-2 text-right text-gray-400">60k <i
                                                    class="fa-solid fa-arrow-right text-gray-300 mx-1"></i> <span
                                                    class="text-red-600 font-bold">0</span></td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 font-bold">Muscle</td>
                                            <td class="px-4 py-2"><span
                                                    class="bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full text-xxs">ä¸‹å•æ˜æ˜¾å˜å°‘</span>
                                            </td>
                                            <td class="px-4 py-2 text-right text-gray-400">60k <i
                                                    class="fa-solid fa-arrow-right text-gray-300 mx-1"></i> <span
                                                    class="text-orange-500 font-bold">25k</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer">Based on quarterly volume comparison</div>
                    </div>

                    <!-- Widget 3C: Capacity Concentration -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fa-solid fa-chart-pie text-blue-500"></i> æœªæ¥ 90 å¤©äº§èƒ½é›†ä¸­åœ¨è°èº«ä¸Šï¼Ÿ
                            </h3>
                        </div>
                        <div class="p-4 flex flex-col justify-between h-full">
                            <div class="h-32 relative">
                                <canvas id="concentrationChart"></canvas>
                            </div>
                            <!-- Risk Warning -->
                            <div class="mt-2 text-xs border-l-2 border-ora-danger pl-2 text-gray-600">
                                <span class="font-bold text-ora-danger">High Risk:</span> å½“å‰å‰ä¸‰å¤§å®¢æˆ·å ç”¨æ’äº§äº§èƒ½çº¦ 72%ï¼Œé›†ä¸­åº¦åé«˜ã€‚
                            </div>
                        </div>
                        <div class="card-footer">Based on scheduled units</div>
                    </div>

                    <!-- Widget 3D: White Space Matrix (PRD 4.4) -->
                    <div class="card lg:col-span-3">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fa-solid fa-border-all text-teal-600"></i> P3-D. å‰‚å‹ç™½åœ°
                                (White Space)</h3>
                            <div class="flex items-center gap-2 text-xxs">
                                <span class="w-3 h-3 bg-teal-600 rounded-sm"></span> æ ¸å¿ƒä¸šåŠ¡
                                <span class="w-3 h-3 bg-teal-100 rounded-sm"></span> å¶å°”ç”Ÿäº§
                                <span class="w-3 h-3 border border-gray-300 border-dashed rounded-sm"></span>
                                ä»æœªåˆä½œ
                            </div>
                        </div>
                        <div class="p-4 overflow-x-auto">
                            <table class="w-full text-xs text-center border-collapse">
                                <thead>
                                    <tr>
                                        <th class="px-3 py-2 text-left font-bold text-gray-600 bg-gray-50 w-40">å“ç‰Œ / å‰‚å‹
                                        </th>
                                        <th class="px-1 py-2 font-medium text-gray-500 bg-gray-50">Gummies</th>
                                        <th class="px-1 py-2 font-medium text-gray-500 bg-gray-50">Powder</th>
                                        <th class="px-1 py-2 font-medium text-gray-500 bg-gray-50">Liquids</th>
                                        <th class="px-1 py-2 font-medium text-gray-500 bg-gray-50">Capsules</th>
                                    </tr>
                                </thead>
                                <tbody class="text-gray-600">
                                    <tr class="border-b border-gray-50">
                                        <td class="p-3 text-left font-bold">Little Umbrella</td>
                                        <td class="p-1">
                                            <div class="bg-teal-600 text-white py-2 rounded shadow-sm"
                                                title="Volume > strong_threshold in last 2y">æ ¸å¿ƒä¸šåŠ¡</div>
                                        </td>
                                        <td class="p-1">
                                            <div class="bg-teal-100 text-teal-800 py-2 rounded"
                                                title="Volume between 0 and threshold">å¶å°”ç”Ÿäº§</div>
                                        </td>
                                        <td class="p-1">
                                            <div class="border border-dashed border-gray-300 text-gray-300 py-2 rounded hover:bg-gray-50 cursor-pointer"
                                                title="No production in last 2y">
                                                ä»æœªåˆä½œ</div>
                                        </td>
                                        <td class="p-1">
                                            <div class="border border-dashed border-gray-300 text-gray-300 py-2 rounded hover:bg-gray-50 cursor-pointer"
                                                title="No production in last 2y">
                                                ä»æœªåˆä½œ</div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="p-3 text-left font-bold">PowerGums</td>
                                        <td class="p-1">
                                            <div class="bg-teal-600 text-white py-2 rounded shadow-sm"
                                                title="Volume > strong_threshold in last 2y">Strong</div>
                                        </td>
                                        <td class="p-1">
                                            <div class="border border-dashed border-gray-300 text-gray-300 py-2 rounded hover:bg-gray-50 cursor-pointer"
                                                title="No production in last 2y">Gap</div>
                                        </td>
                                        <td class="p-1">
                                            <div class="border border-dashed border-gray-300 text-gray-300 py-2 rounded hover:bg-gray-50 cursor-pointer"
                                                title="No production in last 2y">Gap</div>
                                        </td>
                                        <td class="p-1">
                                            <div class="border border-dashed border-gray-300 text-gray-300 py-2 rounded hover:bg-gray-50 cursor-pointer"
                                                title="No production in last 2y">Gap</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </section>
        </div>
    </main>

    <!-- LOGIC -->
    <script>
        // --- Global State ---
        let currentFilter = null;

        // --- Widget P1-A: KPI Filter Logic ---
        function toggleKpiFilterP1(cardId, filterType) {
            const card = document.getElementById(cardId);
            const allCards = document.querySelectorAll('.kpi-card');

            // Toggle Active State
            if (currentFilter === cardId) {
                card.classList.remove('active-filter');
                currentFilter = null;
                // Reset P1-B to All
                filterP1B('all');
                return;
            }

            allCards.forEach(c => c.classList.remove('active-filter'));
            card.classList.add('active-filter');
            currentFilter = cardId;

            // Handle Filter Actions
            if (filterType === 'data_issue') {
                // Scroll to P1-D
                const p1d = document.getElementById('widget-p1d');
                p1d.scrollIntoView({ behavior: 'smooth', block: 'center' });
                p1d.classList.add('target-highlight');
                setTimeout(() => p1d.classList.remove('target-highlight'), 2000);
                // Show all bad records
                filterDataQuality('bad');
            } else {
                // Scroll to P1-B
                const p1b = document.getElementById('widget-p1b');
                p1b.scrollIntoView({ behavior: 'smooth', block: 'center' });
                p1b.classList.add('target-highlight');
                setTimeout(() => p1b.classList.remove('target-highlight'), 2000);

                // Apply Filter to P1-B
                if (filterType === 'leadtime') {
                    filterP1B('delay');
                } else if (filterType === 'money') {
                    filterP1B('blocker'); // For demo, we just show blockers. In real app, filter by reason=money
                } else if (filterType === 'materials') {
                    filterP1B('blocker');
                }
            }
        }

        // --- Widget P1-B: Internal Filter ---
        function filterP1B(filterType) {
            // Update Buttons
            ['all', 'blocker', 'delay'].forEach(t => {
                const btn = document.getElementById(`btn-p1b-${t}`);
                if (t === filterType) {
                    btn.classList.remove('tab-inactive');
                    btn.classList.add('tab-active');
                } else {
                    btn.classList.remove('tab-active');
                    btn.classList.add('tab-inactive');
                }
            });

            // Filter Rows
            const rows = document.querySelectorAll('#p1b-tbody tr');
            rows.forEach(row => {
                if (filterType === 'all') {
                    row.classList.remove('hidden');
                } else if (filterType === 'blocker') {
                    if (row.classList.contains('row-blocker')) row.classList.remove('hidden');
                    else row.classList.add('hidden');
                } else if (filterType === 'delay') {
                    if (row.classList.contains('row-delay')) row.classList.remove('hidden');
                    else row.classList.add('hidden');
                }
            });
        }

        // --- View Switching (List vs Graph) ---
        function switchView(widgetId, viewType) {
            const btnList = document.getElementById(`btn-${widgetId}-view-list`);
            const btnGraph = document.getElementById(`btn-${widgetId}-view-graph`);
            const viewList = document.getElementById(`${widgetId}-view-list`);
            const viewGraph = document.getElementById(`${widgetId}-view-graph`);

            if (viewType === 'list') {
                btnList.className = 'px-2 py-0.5 text-xs rounded bg-white shadow-sm font-bold text-gray-800 border border-gray-200';
                btnGraph.className = 'px-2 py-0.5 text-xs rounded text-gray-500 hover:text-gray-800';
                viewList.classList.remove('hidden');
                viewGraph.classList.add('hidden');
            } else {
                btnList.className = 'px-2 py-0.5 text-xs rounded text-gray-500 hover:text-gray-800';
                btnGraph.className = 'px-2 py-0.5 text-xs rounded bg-white shadow-sm font-bold text-gray-800 border border-gray-200';
                viewList.classList.add('hidden');
                viewGraph.classList.remove('hidden');
            }
        }

        // --- Widget P1-D: Data Quality Filter ---
        function filterDataQuality(type) {
            const tbody = document.getElementById('p1d-tbody');
            const rows = tbody.querySelectorAll('tr');
            const emptyState = document.getElementById('p1d-empty-state');
            const filterLabel = document.getElementById('p1d-current-filter');
            const tableContainer = tbody.parentElement; // table element

            // Reset View
            tableContainer.classList.remove('hidden');
            emptyState.classList.add('hidden');

            // Update Label
            const labelMap = {
                'good': 'è®°å½•å®Œæ•´ Â· æ— éœ€è¡¥å……',
                'bad': 'æ‰€æœ‰é—®é¢˜ (All Issues)',
                'date': 'ç¼ºå°‘å‘è´§æ—¥æœŸ',
                'qty': 'æ•°é‡ä¸ä¸€è‡´',
                'logic': 'æ—¶é—´é¡ºåºå¼‚å¸¸',
                'other': 'å…¶ä»–å­—æ®µç¼ºå¤±'
            };
            filterLabel.textContent = `å½“å‰ç­›é€‰: ${labelMap[type] || type}`;

            if (type === 'good') {
                tableContainer.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            // Filter Rows
            let visibleCount = 0;
            rows.forEach(row => {
                if (type === 'bad') {
                    row.classList.remove('hidden');
                    visibleCount++;
                } else {
                    if (row.classList.contains(`row-issue-${type}`)) {
                        row.classList.remove('hidden');
                        visibleCount++;
                    } else {
                        row.classList.add('hidden');
                    }
                }
            });
        }

        // --- Widget P1-C: Zombie View Logic ---
        function toggleZombieView(view) {
            const btnC = document.getElementById('btn-zombie-contracts');
            const btnI = document.getElementById('btn-zombie-inventory');
            const viewC = document.getElementById('view-zombie-contracts');
            const viewI = document.getElementById('view-zombie-inventory');

            if (view === 'contracts') {
                btnC.className = 'px-3 py-1 text-xs rounded bg-white shadow-sm font-bold text-gray-800 border border-gray-200';
                btnI.className = 'px-3 py-1 text-xs rounded text-gray-500 hover:text-gray-800';
                viewC.classList.remove('hidden');
                viewI.classList.add('hidden');
            } else {
                btnC.className = 'px-3 py-1 text-xs rounded text-gray-500 hover:text-gray-800';
                btnI.className = 'px-3 py-1 text-xs rounded bg-white shadow-sm font-bold text-gray-800 border border-gray-200';
                viewC.classList.add('hidden');
                viewI.classList.remove('hidden');
            }
        }

        // --- Charts Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Register DataLabels plugin globally
            Chart.register(ChartDataLabels);
            Chart.defaults.set('plugins.datalabels', {
                color: '#fff',
                font: { weight: 'bold', size: 10 },
                display: 'auto' // Only show if fits
            });
            Chart.defaults.font.family = "Inter, system-ui, sans-serif";

            // 1E: Data Quality Donut (Good vs Bad)
            new Chart(document.getElementById('dataQualityGoodBad'), {
                type: 'doughnut',
                data: {
                    labels: ['å®Œæ•´ (Good)', 'ç¼ºå¤± (Bad)'],
                    datasets: [{
                        data: [185, 15],
                        backgroundColor: ['#2A9D8F', '#E76F51'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    onClick: (e, activeElements) => {
                        if (activeElements.length > 0) {
                            const index = activeElements[0].index;
                            const type = index === 0 ? 'good' : 'bad';
                            filterDataQuality(type);
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false },
                        datalabels: { display: false }
                    }
                }
            });

            // 1E: Data Quality Donut (Issue Type)
            // 1E: Data Quality Donut (Issue Type)
            new Chart(document.getElementById('dataQualityChart'), {
                type: 'doughnut',
                data: {
                    labels: ['ç¼ºå°‘å‘è´§æ—¥æœŸ', 'æ•°é‡ä¸ä¸€è‡´', 'æ—¶é—´é¡ºåºå¼‚å¸¸', 'å…¶ä»–å­—æ®µç¼ºå¤±'],
                    datasets: [{
                        data: [12, 3, 1, 1],
                        backgroundColor: ['#E76F51', '#F4A261', '#E9C46A', '#264653'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '50%',
                    layout: {
                        padding: 20 // Ensure space for outside labels
                    },
                    onClick: (e, activeElements) => {
                        if (activeElements.length > 0) {
                            const index = activeElements[0].index;
                            const types = ['date', 'qty', 'logic', 'other'];
                            filterDataQuality(types[index]);
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            display: true,
                            color: '#666',
                            anchor: 'end',
                            align: 'end',
                            offset: 10,
                            font: { size: 10, weight: 'normal' },
                            formatter: (value, ctx) => {
                                return ctx.chart.data.labels[ctx.dataIndex];
                            }
                        }
                    }
                },
                plugins: [{
                    id: 'outsideLine',
                    afterDraw: (chart) => {
                        const { ctx, chartArea: { width, height } } = chart;
                        ctx.save();

                        chart.data.datasets.forEach((dataset, i) => {
                            const meta = chart.getDatasetMeta(i);
                            meta.data.forEach((element, index) => {
                                // Only draw if visible
                                if (!element.hidden) {
                                    const { x, y } = element.tooltipPosition();
                                    const center = element.getCenterPoint();

                                    // Calculate outer point (approximate based on radius)
                                    // We can use the tooltip position as a start, and draw to the label position
                                    // But we don't know exact label position easily.
                                    // Let's draw a line from the outer arc to a fixed offset.

                                    const angle = element.startAngle + (element.endAngle - element.startAngle) / 2;
                                    const outerRadius = element.outerRadius;
                                    const lineLength = 10;

                                    const startX = center.x + Math.cos(angle) * outerRadius;
                                    const startY = center.y + Math.sin(angle) * outerRadius;

                                    const endX = center.x + Math.cos(angle) * (outerRadius + lineLength);
                                    const endY = center.y + Math.sin(angle) * (outerRadius + lineLength);

                                    ctx.beginPath();
                                    ctx.moveTo(startX, startY);
                                    ctx.lineTo(endX, endY);
                                    ctx.strokeStyle = '#999';
                                    ctx.lineWidth = 1;
                                    ctx.stroke();
                                }
                            });
                        });
                        ctx.restore();
                    }
                }]
            });

            // 3A: Client Risk Bar
            new Chart(document.getElementById('clientRiskChart'), {
                type: 'bar',
                data: {
                    labels: ['Vitality', 'Muscle'],
                    datasets: [
                        { label: 'ä¸Šå­£åº¦ (Prev Q)', data: [60, 60], backgroundColor: '#E5E7EB', barPercentage: 0.6, datalabels: { color: '#666', anchor: 'end', align: 'top' } },
                        { label: 'æœ¬å­£åº¦ (Curr Q)', data: [5, 25], backgroundColor: ['#E76F51', '#F4A261'], barPercentage: 0.6, datalabels: { color: '#666', anchor: 'end', align: 'top' } }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 } } },
                        tooltip: {
                            callbacks: {
                                afterBody: function (context) {
                                    const idx = context[0].dataIndex;
                                    const risk = idx === 0 ? 'Dormant (ä¼‘çœ )' : 'Cooling (é™æ¸©)';
                                    return `Risk: ${risk}\nPrev: 60k / 3 Contracts\nCurr: ${context[0].raw}k / 1 Contract`;
                                }
                            }
                        },
                        datalabels: { display: true }
                    },
                    scales: { y: { display: false, max: 80 }, x: { grid: { display: false } } }
                }
            });

            // 3C: Capacity Bar
            new Chart(document.getElementById('concentrationChart'), {
                type: 'bar',
                data: {
                    labels: ['Little Umbrella', 'PowerGums', 'å…¶ä»– (Others)'],
                    datasets: [{
                        data: [42, 30, 28],
                        backgroundColor: ['#2A9D8F', '#264653', '#E5E7EB'],
                        borderRadius: 4,
                        barPercentage: 0.5
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { x: { display: false }, y: { grid: { display: false } } },
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            color: '#666',
                            formatter: (value) => value + '%'
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.raw}% ä»½é¢ (${context.raw * 1000} Units)`;
                                }
                            }
                        }
                    }
                }
            });

            // P1: Waterfall (Simulated with Floating Bars)
            new Chart(document.getElementById('p1WaterfallChart'), {
                type: 'bar',
                data: {
                    labels: ['æ¬¾é¡¹åˆ°ä½', 'ç‰©æ–™å°±ç»ª', 'ç­‰å¾…æ’äº§', 'ç”Ÿäº§åˆ¶é€ ', 'å‘è´§'],
                    datasets: [{
                        label: 'é˜¶æ®µè€—æ—¶',
                        data: [
                            [0, 5],    // Stage 1: 0-5
                            [5, 15],   // Stage 2: 5-15 (10d)
                            [15, 20],  // Stage 3: 15-20 (5d)
                            [20, 35],  // Stage 4: 20-35 (15d)
                            [35, 42]   // Stage 5: 35-42 (7d)
                        ],
                        backgroundColor: [
                            '#2A9D8F', '#2A9D8F', '#E9C46A', '#264653', '#2A9D8F'
                        ],
                        borderRadius: 4,
                        barPercentage: 0.6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            formatter: (value) => (value[1] - value[0]) + 'å¤©',
                            color: '#fff',
                            font: { weight: 'bold' }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const v = context.raw;
                                    return `è€—æ—¶: ${v[1] - v[0]} å¤©`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'ç´¯è®¡å¤©æ•° (Cumulative Days)' } }
                    }
                }
            });

            // P2: Breach Rate
            new Chart(document.getElementById('p2BreachChart'), {
                type: 'bar',
                data: {
                    labels: ['S1 æ¬¾é¡¹', 'S2 ç‰©æ–™', 'S3 ç­‰å¾…', 'S4 ç”Ÿäº§', 'S5 å‘è´§'],
                    datasets: [{
                        label: 'è¶…æ—¶æ¯”ä¾‹ (Breach %)',
                        data: [10, 68, 20, 45, 5],
                        backgroundColor: [
                            '#2A9D8F', // <20%
                            '#E76F51', // >50% (Red)
                            '#E9C46A', // 20-50% (Orange)
                            '#E9C46A',
                            '#2A9D8F'
                        ],
                        borderRadius: 4,
                        barPercentage: 0.6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            formatter: (value) => value + '%',
                            anchor: 'end',
                            align: 'top',
                            color: '#666'
                        }
                    },
                    scales: { y: { beginAtZero: true, max: 100 } }
                }
            });

            // P3: Plan Adherence (Mixed)
            new Chart(document.getElementById('p3AdherenceChart'), {
                data: {
                    labels: ['è½¯ç³– (Gummies)', 'ç²‰å‰‚ (Powder)', 'æ¶²ä½“ (Liquids)', 'èƒ¶å›Š (Capsules)'],
                    datasets: [
                        {
                            type: 'bar',
                            label: 'æŒ‰æ—¶äº¤ä»˜ç‡ (Adherence %)',
                            data: [95, 82, 60, 88],
                            backgroundColor: '#264653',
                            yAxisID: 'y',
                            barPercentage: 0.5,
                            borderRadius: 4,
                            datalabels: {
                                color: '#fff',
                                formatter: (value) => value + '%'
                            }
                        },
                        {
                            type: 'line',
                            label: 'å¹³å‡å»¶è¿Ÿ (Avg Delay Days)',
                            data: [1, 4, 12, 2],
                            borderColor: '#E76F51',
                            borderWidth: 2,
                            yAxisID: 'y1',
                            tension: 0.4,
                            datalabels: {
                                align: 'top',
                                color: '#E76F51',
                                formatter: (value) => value + 'd'
                            }
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 } } }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100, position: 'left', title: { display: true, text: 'äº¤ä»˜ç‡ (%)' } },
                        y1: { beginAtZero: true, position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'å»¶è¿Ÿå¤©æ•° (Days)' } }
                    }
                }
            });

            // P4: Material Readiness
            new Chart(document.getElementById('p4MaterialChart'), {
                type: 'doughnut',
                data: {
                    labels: ['å°±ç»ª/å®‰å…¨', 'ç­‰å¾…ä¸­', 'é«˜é£é™©'],
                    datasets: [{
                        data: [85, 10, 5],
                        backgroundColor: ['#2A9D8F', '#E9C46A', '#E76F51'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: {
                        legend: { display: false },
                        datalabels: { display: false }
                    }
                }
            });

            // G1: Factory Growth (Mixed: Bar + Line)
            new Chart(document.getElementById('g1GrowthChart'), {
                data: {
                    labels: ['Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024 (Est)'],
                    datasets: [
                        {
                            type: 'bar',
                            label: 'å­£åº¦å‡ºè´§é‡ (Units)',
                            data: [800000, 950000, 1050000, 1200000],
                            backgroundColor: 'rgba(42, 157, 143, 0.6)',
                            yAxisID: 'y',
                            barPercentage: 0.5,
                            borderRadius: 4,
                            datalabels: {
                                color: '#fff',
                                formatter: (value) => (value / 10000) + 'ä¸‡'
                            }
                        },
                        {
                            type: 'line',
                            label: 'å¹³å‡äº¤ä»˜å‘¨æœŸ (Days)',
                            data: [48, 46, 45, 42],
                            borderColor: '#264653',
                            borderWidth: 2,
                            yAxisID: 'y1',
                            tension: 0.4,
                            datalabels: {
                                align: 'top',
                                color: '#264653',
                                formatter: (value) => value + 'd'
                            }
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 } } }
                    },
                    scales: {
                        y: { beginAtZero: true, position: 'left', title: { display: true, text: 'å‡ºè´§é‡ (Units)' } },
                        y1: { beginAtZero: false, min: 30, position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'å‘¨æœŸ (Days)' } }
                    }
                }
            });
        });
    </script>
</body>

</html>